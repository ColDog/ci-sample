default_build: &default_build
  services:
    mysql:
      image: 'mysql:5.7'
      env:
        MYSQL_DEFAULT_PASSWORD: pass
      on_startup:
        - "echo 'hello from mysql'"
  
  env:
    TEST: true
  
  setup:
    - "echo 'setup'"
  
  before:
    - "echo 'pre test'"
  main:
    - "sleep 5"
    - "echo 'testing'"
  after:
    - "echo 'post test'"
  on_success:
    - "echo 'on success'"
  on_failure:
    - "echo 'on failure'"

builds:
  # build number 1
  - <<: *default_build
    env:
      NAME: 'coldog'
      STUFF: 'things'
      
    main:
      - "sleep 6"
      - "echo $STUFF"
      - "echo $NAME"
  
  # build number 2
  - <<: *default_build
    main:
      - "sleep 7"

  # build number 3  
  - <<: *default_build
    main:
      - "exit 127"
